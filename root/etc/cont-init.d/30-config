#!/usr/bin/with-contenv bash
# shellcheck shell=bash

cd /app/conreq || return

python3 ./manage.py makemigrations
python3 ./manage.py migrate
python3 ./manage.py check
python3 ./manage.py collectstatic

# permissions
chown -R abc:abc \
    /app \
    /config

cat <<EOF | s6-setuidgid abc python3 /app/conreq/manage.py shell
from os import getenv
from django.contrib.auth import get_user_model

User = get_user_model()  # get the currently active user model,

User.objects.filter(username='demo').exists() or \
    User.objects.create_superuser('demo', email='email@gmail.home', password=getenv('password', default='secretpass'))
EOF
